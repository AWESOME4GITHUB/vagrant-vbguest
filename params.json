{"name":"Vagrant-vbguest","tagline":"A Vagrant plugin to keep your VirtualBox Guest Additions up to date","body":"# vagrant-vbguest\r\n\r\n*vagrant-vbguest* is a [Vagrant](http://vagrantup.com) plugin which automatically installs the host's VirtualBox Guest Additions on the guest system.\r\n\r\n[![Code Climate](https://codeclimate.com/github/dotless-de/vagrant-vbguest.png)](https://codeclimate.com/github/dotless-de/vagrant-vbguest) [![Dependency Status](https://gemnasium.com/dotless-de/vagrant-vbguest.png)](https://gemnasium.com/dotless-de/vagrant-vbguest)\r\n\r\n## Installation\r\n\r\nRequires vagrant 0.9.4 or later (including 1.x)\r\n\r\n### Vagrant â‰¥ 1.1\r\n\r\n```bash\r\n$ vagrant plugin install vagrant-vbguest\r\n```\r\n\r\n### Vagrant 1.0 and older\r\n\r\nSince vagrant v1.0.0 the preferred installation method for vagrant is using the provided packages or installers.\r\nIf you installed vagrant that way, you need to use vagrant's gem wrapper:\r\n\r\n```bash\r\n$ vagrant gem install vagrant-vbguest\r\n```\r\n\r\nIf you installed vagrant using RubyGems, use:\r\n\r\n```bash\r\n$ gem install vagrant-vbguest\r\n```\r\n\r\nCompatibly for vagrant 0.8 is provided by version 0.0.3 (which lacks a bunch of new options)\r\n\r\n## Configuration / Usage\r\n\r\nIf you're lucky, *vagrant-vbguest* does not require any configurations. \r\nHowever, here is an example for your `Vagrantfile`:\r\n\r\n```ruby\r\nVagrant::Config.run do |config|\r\n  # we will try to autodetect this path. \r\n  # However, if we cannot or you have a special one you may pass it like:\r\n  # config.vbguest.iso_path = \"#{ENV['HOME']}/Downloads/VBoxGuestAdditions.iso\"\r\n  # or\r\n  # config.vbguest.iso_path = \"http://company.server/VirtualBox/%{version}/VBoxGuestAdditions.iso\"\r\n  \r\n  # set auto_update to false, if do NOT want to check the correct additions \r\n  # version when booting this machine\r\n  config.vbguest.auto_update = false\r\n  \r\n  # do NOT download the iso file from a webserver\r\n  config.vbguest.no_remote = true\r\nend\r\n```\r\n\r\n### Config options\r\n\r\n* `iso_path` : The full path or URL to the VBoxGuestAdditions.iso file. <br/>\r\nThe `iso_path` may contain the optional placeholder `%{version}` for the detected version (e.g. `4.1.8`).\r\nThe URI for the actual iso download reads: `http://download.virtualbox.org/virtualbox/%{version}/VBoxGuestAdditions_%{version}.iso`<br/>\r\nvbguest will try to autodetect the best option for your system. WTF? see below.\r\n* `auto_update` (Boolean, default: `true`) : Whether to check the correct additions version on each start (where start is _not_ resuming a box).\r\n* `auto_reboot` (Boolean, default: `true` when running as a middleware, `false` when running as a command) : Whether to reboot the box after GuestAdditions has been installed, but not loaded.\r\n* `no_install` (Boolean, default: `false`) : Whether to check the correct additions version only. This will warn you about version mis-matches, but will not try to install anything.\r\n* `no_remote` (Boolean, default: `false`) : Whether to _not_ download the iso file from a remote location. This includes any `http` location!\r\n* `installer` (`VagrantVbguest::Installers::Base`, optional) : Reference to a (custom) installer class\r\n\r\n#### Global Configuration\r\n\r\nUsing [Vagrantfile Load Order](http://vagrantup.com/v1/docs/vagrantfile.html#vagrantfile_load_order) you may change default configuration values.\r\nEdit (create, if missing) your `~/.vagrant.d/Vagrantfile` like this:\r\n\r\nFor Vagrant >= 1.1.0 use:\r\n\r\n```ruby\r\nVagrant.configure(\"2\") do |config|\r\n  config.vbguest.auto_update = false\r\nend\r\n```\r\n\r\nFor older versions of Vagrant:\r\n\r\n```ruby\r\n# vagrant's autoloading may not have kicked in\r\nrequire 'vagrant-vbguest' unless defined? VagrantVbguest::Config\r\nVagrantVbguest::Config.auto_update = false\r\n```\r\n\r\nSettings in a project's `Vagrantfile` will overwrite those setting. When executed as a command, command line arguments will overwrite all of the above.\r\n\r\n\r\n### Running as a middleware\r\n\r\nRunning as a middleware will is the default way using *vagrant-vbguest*. \r\nIt will run automatically right after the box started. This is each time the box boots, i.e. `vagrant up` or `vagrant reload`. \r\nIt won't run on `vagrant resume` (or `vagrant up` a suspended box) to save you some time resuming a box.\r\n\r\nYou may switch off the middleware by setting the vm's config `vbguest.auto_update` to `false`.\r\nThis is a per box settings. On multi vm environments you need to set that for each vm.\r\n\r\nWhen *vagrant-vbguest* is running it will provide you some logs:\r\n\r\n    [...]\r\n    [default] Booting VM...\r\n    [default] Booting VM...\r\n    [default] Waiting for VM to boot. This can take a few minutes.\r\n    [default] VM booted and ready for use!\r\n    [default] GuestAdditions versions on your host (4.2.6) and guest (4.1.0) do not match.\r\n    stdin: is not a tty\r\n    Reading package lists...\r\n    Building dependency tree...\r\n    Reading state information...\r\n    The following extra packages will be installed:\r\n      fakeroot linux-headers-2.6.32-33 patch\r\n\r\n    [...]\r\n\r\n    [default] Copy iso file /Applications/VirtualBox.app/Contents/MacOS/VBoxGuestAdditions.iso into the box /tmp/VBoxGuestAdditions.iso\r\n    stdin: is not a tty\r\n    [default] Installing Virtualbox Guest Additions 4.2.6 - guest version is 4.1.0\r\n    stdin: is not a tty\r\n    Verifying archive integrity... All good.\r\n    Uncompressing VirtualBox 4.2.6 Guest Additions for Linux...........\r\n    VirtualBox Guest Additions installer\r\n    Removing installed version 4.1.0 of VirtualBox Guest Additions...\r\n    tar: Record size = 8 blocks\r\n    Removing existing VirtualBox DKMS kernel modules ...done.\r\n    Removing existing VirtualBox non-DKMS kernel modules ...done.\r\n    Building the VirtualBox Guest Additions kernel modules ...done.\r\n    Doing non-kernel setup of the Guest Additions ...done.\r\n    You should restart your guest to make sure the new modules are actually used\r\n\r\n    Installing the Window System drivers ...fail!\r\n    (Could not find the X.Org or XFree86 Window System.)\r\n    stdin: is not a tty\r\n    [default] Restarting VM to apply changes...\r\n    [default] Attempting graceful shutdown of VM...\r\n    [default] Booting VM...\r\n    [default] Waiting for VM to boot. This can take a few minutes.\r\n    [default] VM booted and ready for use!\r\n    [default] Configuring and enabling network interfaces...\r\n    [default] Setting host name...\r\n    [default] Mounting shared folders...\r\n    [default] -- v-root: /vagrant\r\n    [default] -- v-csc-1: /tmp/vagrant-chef-1/chef-solo-1/cookbooks\r\n    [default] Running provisioner: Vagrant::Provisioners::ChefSolo...\r\n    [default] Generating chef JSON and uploading...\r\n    [default] Running chef-solo...\r\n    [...]\r\n\r\n\r\nThe plugin's part starts at `[default] Installing Virtualbox Guest Additions 4.1.14 - guest's version is 4.1.1`, telling you that:\r\n\r\n* the guest addition of the box *default* are outdated (or mismatch) \r\n* which guest additions iso file will be used \r\n* which installer script will be used\r\n* all the VirtualBox Guest Additions installer output.\r\n\r\nNo worries on the `Installing the Window System drivers ...fail!`. Most dev boxes you are using won't run a Window Server, thus it's absolutely safe to ignore that error.\r\n\r\nWhen everything is fine, and no update is needed, you see log like:\r\n\r\n    ...\r\n    [default] Booting VM...\r\n    [default] Waiting for VM to boot. This can take a few minutes.\r\n    [default] VM booted and ready for use!\r\n    [default] GuestAdditions 4.2.6 running --- OK.\r\n    ...\r\n\r\n\r\n### Running as a Command\r\n\r\nWhen you switched off the middleware auto update, or you have a box up and running you may also run the installer manually.\r\n\r\n```bash\r\n$ vagrant vbguest [vm-name] [--do start|rebuild|install] [--status] [-f|--force] [-b|--auto-reboot] [-R|--no-remote] [--iso VBoxGuestAdditions.iso]\r\n```\r\n\r\nFor example, when you just updated Virtual Box on your host system, you should update the gust additions right away. However, you may need to reload the box to get the guest additions working.\r\n\r\nIf you want to check the guest additions versions, without installing them, you may run:\r\n\r\n```bash\r\n$ vagrant vbguest --status\r\n```\r\n\r\nTelling you either about a version mismatch:\r\n\r\n    [default] GuestAdditions versions on your host (4.2.6) and guest (4.1.0) do not match.\r\n\r\nor a match:\r\n\r\n    [default] GuestAdditions 4.2.6 running --- OK.\r\n\r\n\r\nThe `auto-reboot` is tured off by default, when running as a command. Vbguest will suggest you to reboot the box when needed. To turn it on simply pass the `--auto-reboot` parameter:\r\n\r\n```bash\r\n$ vagrant vbguest --auto-reboot\r\n```\r\n\r\nYou can also pass vagrant's `reload` options like:\r\n\r\n```bash\r\n$ vagrant vbguest --auto-reboot --no-provision\r\n```\r\n\r\n\r\n\r\n### ISO autodetection\r\n\r\n*vagrant-vbguest* will try to autodetect a VirtualBox GuestAdditions iso file on your system, which usually matches your installed version of VirtualBox. If it cannot find one, it downloads one from the web (virtualbox.org).   \r\nThose places will be checked in order:\r\n\r\n1. Checks your VirualBox \"Virtual Media Maganger\" for a DVD called \"VBoxGuestAdditions.iso\"\r\n2. Guess by your host operating system:\r\n  * for linux : `/usr/share/virtualbox/VBoxGuestAdditions.iso`\r\n  * for Mac : `/Applications/VirtualBox.app/Contents/MacOS/VBoxGuestAdditions.iso`\r\n  * for Windows : `%PROGRAMFILES%/Oracle/VirtualBox/VBoxGuestAdditions.iso`\r\n\r\n\r\n### Automatic reboot\r\n\r\nThe VirtualBox GuestAdditions Installer will try to load the newly build kernel module. However the installer my fail to do, just as it is happening when updating GuestAdditions from version 4.1 to 4.2.\r\n\r\nHency, vbguest will check for a loaded kernel module after the installation has finished and reboots the box, if it could not find one.\r\n\r\n\r\n## Advanced Usage\r\n\r\nvagrant-vbguest provides installers for generic linux and debian/ubuntu.  \r\nInstallers take care of the whole installation process, that includes where to save the iso file inside the guest and where to mount it.\r\n\r\n```ruby\r\nclass MyInstaller < VagrantVbguest::Installers::Linux\r\n\r\n  # use /temp instead of /tmp\r\n  def tmp_path\r\n    '/temp/VBoxGuestAdditions.iso'\r\n  end\r\n\r\n  # use /media instead of /mnt\r\n  def mount_point\r\n    '/media'\r\n  end\r\n\r\n  def install(opts=nil, &block)\r\n    communicate.sudo('my_distos_way_of_preparing_guestadditions_installation', opts, &block)\r\n    # calling `super` will run the installation\r\n    # also it takes care of uploading the right iso file into the box\r\n    # and cleaning up afterward\r\n    super\r\n  end\r\nend\r\n\r\nVagrant::Config.run do |config|\r\n  config.vbguest.installer = MyInstaller\r\nend\r\n```\r\n\r\n\r\n## Knows Issues\r\n\r\n* The installer script, which mounts and runs the GuestAdditions Installer Binary, works on linux only. Most likely it will run on most unix-like plattform.\r\n* The installer script requires a directory `/mnt` on the guest system\r\n* On multi vm boxes, the iso file will be downloaded for each vm\r\n* The plugin installation on Windows host systems my not work as expected (using `vagrant gem install vagrant-vbguest`). Try `C:\\vagrant\\vagrant\\embedded\\bin\\gem.bat install vagrant-vbguest` instead. (See [issue #19](https://github.com/dotless-de/vagrant-vbguest/issues/19#issuecomment-7040304))\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}